<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snowman Adventure</title>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- TON Connect UI SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --bg-dark: #050f1a;
            --text-light: #E3F4F9;
            --accent-cyan: #00E5FF;
            --accent-violet: #6A5ACD;
            --glass-bg: linear-gradient(145deg, rgba(22, 52, 80, 0.4) 0%, rgba(8, 24, 43, 0.6) 100%);
            --glass-border: 1px solid rgba(0, 229, 255, 0.15);
            --level-gold: #FFD700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text-light);
            height: 100dvh; 
            overflow: hidden;
            display: flex;
            justify-content: center;
            background-color: #050f1a; 
            transition: background 0.3s ease;
        }

        body.home-active {
            background-image: url('https://alamin12071985-a11y.github.io/cine-link/background.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* --- UPDATED LOADING SCREEN (THINNER BAR) --- */
        #loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            background-image: url('loading screen.png');
            background-size: cover;
            background-position: center bottom;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 15vw;
            transition: opacity 0.5s ease;
        }

        .loading-container {
            width: 80vw;
            height: 12px; /* অনেক চিকন করা হয়েছে */
            background-color: #050f1a;
            border: 1px solid var(--accent-cyan);
            border-radius: 10px;
            position: relative;
            padding: 2px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(to right, #00E5FF, #6A5ACD);
            border-radius: 8px;
            position: relative;
            transition: width 0.1s linear;
        }

        .percentage {
            position: absolute;
            top: -25px;
            right: 0;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            text-shadow: 1px 1px 0px #000;
        }

        /* --- APP CONTAINER --- */
        .app-container {
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2); 
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(2px);
        }

        /* --- HEADER --- */
        .header-dashboard {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 20;
            background: linear-gradient(180deg, rgba(5,15,26,0.9) 0%, rgba(5,15,26,0) 100%);
        }

        .stat-card-left {
            background: var(--glass-bg);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 229, 255, 0.2);
            border-radius: 12px; 
            padding: 5px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        .stat-label { font-size: 0.65rem; color: var(--accent-cyan); opacity: 0.8; }
        .stat-value { font-size: 0.85rem; font-weight: 700; display: flex; align-items: center; gap: 4px; }
        .stat-value img { width: 16px; }

        .profile-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 5px;
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.3);
            padding: 3px 12px 3px 3px;
            border-radius: 30px;
            border: 1px solid rgba(0, 229, 255, 0.1);
            margin-bottom: 3px;
        }
        .user-avatar { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--accent-cyan); object-fit: cover; }
        .user-name { font-weight: 700; font-size: 0.85rem; max-width: 90px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

        .header-level-box { width: 100%; max-width: 120px; }
        .lvl-text { font-size: 0.65rem; color: rgba(255,255,255,0.7); display: flex; justify-content: space-between; margin-bottom: 2px; }
        .header-progress-bg { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; border: 1px solid rgba(0,229,255,0.2); }
        .header-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #FF8C00, #FFD700); }

        .settings-btn {
            background: var(--glass-bg);
            border-radius: 50%; width: 35px; height: 35px;
            display: flex; justify-content: center; align-items: center;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }
        .settings-btn img { width: 20px; }

        /* --- CONTENT AREA & RESPONSIVENESS --- */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0 15px 90px 15px; 
            position: relative;
        }
        .tab-content { display: none; flex-direction: column; animation: fadeIn 0.4s ease; height: 100%; }
        .tab-content.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- MENU --- */
        .daily-menu-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 5px;
            position: relative;
            z-index: 5;
        }
        .daily-item {
            flex: 1;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, rgba(5, 15, 26, 0.6) 100%);
            border: 1px solid rgba(0, 229, 255, 0.2);
            border-radius: 12px;
            padding: 8px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            min-height: 75px;
        }
        .daily-item:active { transform: scale(0.96); }
        .daily-item img { width: 35px; height: 35px; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(0,229,255,0.4)); }
        .daily-item span { font-size: 0.65rem; font-weight: 600; text-align: center; line-height: 1.1; }
        .daily-sub-text { font-size: 0.6rem; color: var(--accent-cyan); font-weight: 700; margin-top: 2px; }

        /* --- GAME AREA --- */
        .game-area-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            padding: 10px 0;
            position: relative;
            z-index: 10;
        }

        .main-balance {
            font-size: clamp(2rem, 6vw, 2.8rem);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 20px rgba(0,229,255,0.3);
        }
        .main-balance img { width: clamp(35px, 8vw, 50px); }

        /* CHARACTER IMAGE - RESPONSIVE FIX */
        .character-img {
            width: auto;
            height: clamp(250px, 45vh, 400px); /* Responsive height */
            max-width: 90vw;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.1s;
            filter: drop-shadow(0 0 15px rgba(0, 229, 255, 0.2));
            object-fit: contain;
        }
        .character-img:active { transform: scale(0.96) rotate(-2deg); }
        
        .start-mining-img {
            width: clamp(140px, 40vw, 200px);
            cursor: pointer;
            animation: pulse 2s infinite;
            margin-top: -30px;
            z-index: 25;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .bottom-controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 10px;
            margin-top: 10px;
        }
        .control-item {
            display: flex; align-items: center; gap: 6px;
            font-size: 0.8rem; color: rgba(255,255,255,0.8);
            background: rgba(0,0,0,0.4); padding: 5px 12px;
            border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
        }
        .control-item img { width: 18px; }

        /* --- NAV BAR --- */
        .nav-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 80px;
            background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.95) 100%);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100; padding-bottom: 10px;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;
            width: 60px; height: 55px; border-radius: 12px; color: rgba(255, 255, 255, 0.4);
        }
        .nav-item img { width: 24px; height: 24px; opacity: 0.5; filter: grayscale(100%); }
        .nav-item span { font-size: 0.65rem; font-weight: 500; }
        .nav-item.active { color: var(--accent-cyan); background: rgba(0, 229, 255, 0.05); }
        .nav-item.active img { opacity: 1; filter: grayscale(0%); transform: scale(1.1); }

        /* --- STORE & OUTFITS --- */
        .glass-panel-full {
            background: var(--glass-bg);
            border: var(--glass-border);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .boost-section-title { font-size: 1rem; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .boost-item {
            background: rgba(30, 35, 50, 0.6);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .boost-info { display: flex; flex-direction: column; }
        .boost-name { font-weight: 600; font-size: 0.85rem; color: #fff; }
        .boost-desc-small { font-size: 0.65rem; color: rgba(255,255,255,0.5); }
        
        .boost-price-btn {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 15px;
            display: flex; align-items: center; gap: 4px;
            cursor: pointer;
            border: 1px solid rgba(255, 215, 0, 0.3);
            min-width: 70px;
            justify-content: center;
        }
        .boost-price-val { font-weight: 700; font-size: 0.8rem; color: #FFD700; }
        .btn-activate { background: rgba(0, 230, 118, 0.2); border-color: #00E676; }
        .btn-activate .boost-price-val { color: #00E676; }
        
        .outfit-thumb {
            width: 40px; height: 40px; border-radius: 8px; object-fit: cover; margin-right: 10px;
            border: 1px solid rgba(255,255,255,0.2); background: #000;
        }

        /* --- LOTTERY MODAL --- */
        .lottery-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        .lottery-modal.active { display: flex; }
        .lottery-box {
            background: linear-gradient(160deg, #6A5ACD 0%, #050f1a 100%);
            border: 2px solid #00E5FF;
            border-radius: 20px; padding: 15px; width: 90%; max-width: 350px;
            box-shadow: 0 0 30px rgba(106, 90, 205, 0.6); position: relative;
        }
        .lottery-close {
            position: absolute; top: -10px; right: -10px; width: 30px; height: 30px;
            background: #FF4757; border-radius: 50%; color: white; display: flex;
            justify-content: center; align-items: center; cursor: pointer; border: 2px solid white;
        }
        .grid-container {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
            background: rgba(0,0,0,0.3); padding: 8px; border-radius: 12px; margin-top: 10px;
        }
        .grid-item {
            background: #F0F4FF; border-radius: 8px; height: 70px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; border: 2px solid transparent;
        }
        .grid-item.active {
            box-shadow: 0 0 15px #00E5FF; border: 2px solid #6A5ACD; transform: scale(1.05); z-index: 5;
        }
        .grid-item img { width: 35px; height: 35px; object-fit: contain; }
        .grid-item span { font-size: 0.6rem; color: #333; font-weight: bold; margin-top: 2px; }
        .spin-btn {
            width: 100%; padding: 12px; margin-top: 15px;
            background: linear-gradient(180deg, #00E5FF 0%, #0091EA 100%);
            border: none; border-radius: 25px; color: white; font-weight: 800;
            text-transform: uppercase; box-shadow: 0 0 10px #00E5FF;
        }
        
        .floating-score {
            position: absolute; color: var(--accent-cyan); font-weight: 800; font-size: 24px;
            animation: floatUp 0.8s ease-out forwards; z-index: 100; pointer-events: none;
            text-shadow: 0 0 5px black;
        }
        @keyframes floatUp { to { opacity: 0; transform: translateY(-80px); } }
        
        /* OTHER BUTTONS */
        .popup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 2000; display: none; justify-content: center; align-items: center;
        }
        .popup-content {
            background: linear-gradient(145deg, #163450 0%, #08182b 100%);
            border: 2px solid var(--accent-cyan); border-radius: 20px; padding: 25px;
            text-align: center; width: 85%; max-width: 320px;
        }
        .popup-btn {
            background: linear-gradient(90deg, #00C853, #64DD17); color: #000; border: none;
            padding: 10px 0; width: 100%; border-radius: 10px; font-weight: 800; margin-top: 15px;
        }
        
        /* TASK CARD */
        .task-card {
            background: rgba(255,255,255,0.05); border-radius: 12px; padding: 12px;
            display: flex; align-items: center; justify-content: space-between;
            border: 1px solid rgba(255,255,255,0.05); margin-bottom: 10px;
        }

    </style>
</head>
<body class="home-active">

    <!-- AUDIO FOR SPIN -->
    <audio id="spinSound" src="https://github.com/alamin12071985-a11y/cine-link/raw/bfe25795844512b96dc53827a257581c5d424bf4/spinning%20wheel.mp3"></audio>

    <!-- GENERIC POPUP -->
    <div id="glassPopup" class="popup-overlay">
        <div class="popup-content" id="popupContent">
            <!-- Injected via JS -->
        </div>
    </div>

    <!-- LOTTERY MODAL -->
    <div id="lotteryModal" class="lottery-modal">
        <div class="lottery-box">
            <div class="lottery-close" onclick="closeLottery()">✕</div>
            <h3 style="text-align:center; color:white; margin-bottom:5px;">Lucky Draw</h3>
            <p style="text-align:center; font-size:0.8rem; color:#ccc;">Grand Prize: Crystal-Tech Suit!</p>
            
            <div class="grid-container" id="lotteryGrid">
                <!-- Row 1 -->
                <div class="grid-item" id="c0"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>200 Coin</span></div>
                <div class="grid-item" id="c1"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>500 Coin</span></div>
                <div class="grid-item" id="c2"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>1000 Coin</span></div>
                <!-- Row 2 -->
                <div class="grid-item" id="c7"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>100 Coin</span></div>
                <div class="grid-item" id="cCenter" style="background:#b3e5fc;"><img src="https://alamin12071985-a11y.github.io/cine-link/Crystal-Tech Master Pack.png" style="width:45px; height:45px;"><span>JACKPOT</span></div>
                <div class="grid-item" id="c3"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>300 Coin</span></div>
                <!-- Row 3 -->
                <div class="grid-item" id="c6"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>50 Coin</span></div>
                <div class="grid-item" id="c5"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>150 Coin</span></div>
                <div class="grid-item" id="c4"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png"><span>800 Coin</span></div>
            </div>

            <button class="spin-btn" id="lotterySpinBtn" onclick="playLottery()">
                Spin (15 <img src="https://alamin12071985-a11y.github.io/cine-link/star.png" width="12" style="vertical-align:middle;">)
            </button>
        </div>
    </div>

    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="loading-container">
            <div class="progress-bar" id="loadingFill">
                <span class="percentage" id="loadingPercent">0%</span>
            </div>
        </div>
    </div>

    <div class="app-container">
        
        <!-- HEADER -->
        <div class="header-dashboard" id="mainHeader">
            <div class="stat-card-left">
                <div class="stat-value"><img src="https://alamin12071985-a11y.github.io/cine-link/coin.png" alt="C"><span id="miningRateText">+0</span></div>
                <div class="stat-label">/hour</div>
            </div>
            <div class="profile-section">
                <div class="profile-top">
                    <img id="headerAvatar" src="https://alamin12071985-a11y.github.io/cine-link/snowman.png" class="user-avatar" alt="User">
                    <span id="headerName" class="user-name">User</span>
                </div>
                <div class="header-level-box">
                    <div class="lvl-text"><span id="levelNameHeader">Lvl 1</span><span><span id="currentLevelHeader">0</span>/10</span></div>
                    <div class="header-progress-bg"><div class="header-progress-fill" id="headerLevelBar"></div></div>
                </div>
            </div>
            <div class="settings-btn"><img src="https://alamin12071985-a11y.github.io/cine-link/setting.png" alt="Set"></div>
        </div>

        <div class="content-area">
            
            <!-- HOME TAB -->
            <div id="home" class="tab-content active">
                <div class="daily-menu-container">
                    <div class="daily-item" onclick="claimDailyReward()">
                        <img src="https://alamin12071985-a11y.github.io/cine-link/reward.png" alt="Reward">
                        <span>Daily Reward</span>
                        <div id="dailyRewardAmount" class="daily-sub-text">+500</div>
                    </div>
                    <div class="daily-item" onclick="goToSpinPage()">
                        <img src="https://alamin12071985-a11y.github.io/cine-link/spin.png" alt="Spin">
                        <span>Spin</span>
                        <div class="daily-sub-text">Free</div>
                    </div>
                    <!-- NEW LOTTERY BUTTON REPLACING TAPS DONE -->
                    <div class="daily-item" onclick="openLottery()">
                        <img src="https://alamin12071985-a11y.github.io/cine-link/lottary.png" alt="Lottary">
                        <span>Lottery</span>
                        <div class="daily-sub-text">Win Suit</div>
                    </div>
                </div>

                <div class="game-area-wrapper" id="snowContainer">
                    <div class="main-balance">
                        <img src="https://alamin12071985-a11y.github.io/cine-link/coin.png" alt="C">
                        <span id="displayBalance">0</span>
                    </div>
                    
                    <!-- DYNAMIC OUTFIT IMAGE -->
                    <img src="https://alamin12071985-a11y.github.io/cine-link/snowman.png" class="character-img" id="clickerBtn" alt="Snowman">
                    
                    <img src="https://alamin12071985-a11y.github.io/cine-link/start%20mining.png" class="start-mining-img" onclick="handleStartMining()" alt="Start">
                    
                    <div class="bottom-controls">
                        <div class="control-item" onclick="openBoostPage()">
                            <img src="https://alamin12071985-a11y.github.io/cine-link/energy.png" alt="E"><span id="energyDisplay">500</span>/500
                        </div>
                        <div class="control-item" onclick="openBoostPage()">
                            <img src="https://alamin12071985-a11y.github.io/cine-link/boost.png" alt="B"><span>Boost</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BOOST / PREMIUM STORE PAGE -->
            <div id="boostPage" class="tab-content">
                <div style="padding: 10px 0; display:flex; align-items:center;">
                    <div onclick="switchTab('home')" style="width:30px; height:30px; background:rgba(255,255,255,0.1); border-radius:50%; display:flex; justify-content:center; align-items:center; margin-right:15px; cursor:pointer;">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    <h2>Store</h2>
                </div>

                <!-- OUTFITS SECTION (DYNAMICALLY GENERATED) -->
                <div class="glass-panel-full" id="outfitStore">
                    <!-- JS WILL FILL THIS -->
                </div>

                <!-- EXISTING BOOSTS -->
                <div class="glass-panel-full">
                    <div class="boost-section-title">Essential Boosts</div>
                    
                    <div class="boost-item">
                        <div class="boost-info"><span class="boost-name">Full Energy Refill</span></div>
                        <div class="boost-price-btn" id="btn_energy_refill" onclick="handleStoreClick(this, 'energy_refill', 50)">
                            <img src="https://alamin12071985-a11y.github.io/cine-link/star.png"><span class="boost-price-val">50</span>
                        </div>
                    </div>
                    <div class="boost-item">
                        <div class="boost-info"><span class="boost-name">Multitap (7 Days)</span></div>
                        <div class="boost-price-btn" id="btn_multitap_7d" onclick="handleStoreClick(this, 'multitap_7d', 150)">
                            <img src="https://alamin12071985-a11y.github.io/cine-link/star.png"><span class="boost-price-val">150</span>
                        </div>
                    </div>
                    <div class="boost-item">
                        <div class="boost-info"><span class="boost-name">Auto Bot (30 Days)</span></div>
                        <div class="boost-price-btn" id="btn_bot_30d" onclick="handleStoreClick(this, 'bot_30d', 700)">
                            <img src="https://alamin12071985-a11y.github.io/cine-link/star.png"><span class="boost-price-val">700</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EARN TAB -->
            <div id="earn" class="tab-content">
                <div class="glass-panel-full" style="text-align:center;">
                    <img src="https://alamin12071985-a11y.github.io/cine-link/earn%20page.png" style="width:150px; border-radius:10px; margin-bottom:10px;">
                    <h2 style="color:var(--accent-cyan); margin-bottom:5px;">Earn Coins</h2>
                    <p style="font-size:0.8rem; opacity:0.8;">Complete tasks to earn more!</p>
                </div>
                <div class="glass-panel-full" id="taskList">
                    <div style="text-align:center; padding:10px;">Loading tasks...</div>
                </div>
            </div>

            <!-- FRIENDS TAB -->
            <div id="friends" class="tab-content">
                <div class="glass-panel-full" style="text-align:center; padding-top: 10px;">
                    <img src="https://alamin12071985-a11y.github.io/cine-link/friends%20page.png" width="240" style="margin-bottom:10px; border-radius:10px;">
                    <h2 style="color:var(--accent-cyan);">Invite Friends</h2>
                    <p style="font-size:0.9rem;">Invite friends and get bonuses!</p>
                    <img src="https://alamin12071985-a11y.github.io/cine-link/invite%20friends.png" onclick="inviteFriend()" style="width: 80%; margin-top: 15px; cursor: pointer;">
                </div>
            </div>

            <!-- WALLET TAB -->
            <div id="wallet" class="tab-content">
                <div style="text-align:center; padding-top: 20px;">
                    <h1 style="font-size:3rem; line-height:1.1; font-weight:800; color:var(--accent-cyan);">Get Real<br>Crypto.</h1>
                    <p style="color:rgba(227, 244, 249, 0.7); font-size: 1rem; margin-top:10px;">Connect your TON wallet.</p>
                    
                    <img id="connectWalletBtn" src="https://alamin12071985-a11y.github.io/cine-link/connect%20wallet.png" onclick="connectWallet()" style="width:90%; max-width: 250px; margin-top:20px; cursor: pointer;">
                    
                    <div style="margin-top:20px; background:#000; border:1px solid rgba(255,255,255,0.2); border-radius:40px; padding:10px 20px; display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="openExchangePopup()">
                        <img src="https://alamin12071985-a11y.github.io/cine-link/exchange.png" style="width:40px;">
                        <div style="text-align:left;">
                            <h3 style="font-size:0.9rem; color:white;">Exchange</h3>
                            <p style="font-size:0.7rem; color:grey;">Coming Soon</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SPIN PAGE -->
            <div id="spinPage" class="tab-content">
                <div class="glass-panel-full" style="text-align:center; position:relative; height: 80vh;">
                    <h2>Lucky Spin</h2>
                    <p>Spin to win coins!</p>
                    
                    <img src="arrow.png" style="position:absolute; top:4vh; left:50%; transform:translateX(-50%); width:50px; z-index:15;" alt="Arrow">
                    
                    <div style="width:80vw; max-width:300px; height:80vw; max-height:300px; margin:20px auto; transition:transform 4s cubic-bezier(0.1, 0.7, 0.1, 1);" id="wheel">
                        <img src="spin wheel.png" style="width:100%; height:100%; object-fit:contain;">
                    </div>
                    
                    <button onclick="doSpin()" style="margin-top:20px; padding:15px 40px; background:var(--accent-cyan); border:none; border-radius:25px; font-weight:bold; font-size:1.2rem;">SPIN</button>
                    <button onclick="switchTab('home')" style="margin-top:20px; display:block; width:100%; background:transparent; border:1px solid white; color:white; padding:10px; border-radius:10px;">Back to Home</button>
                </div>
            </div>

        </div>

        <!-- NAVIGATION -->
        <div class="nav-bar">
            <div class="nav-item active" onclick="switchTab('home', this)">
                <img src="https://alamin12071985-a11y.github.io/cine-link/home.png" alt="Home">
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="switchTab('earn', this)">
                <img src="https://alamin12071985-a11y.github.io/cine-link/task.png" alt="Earn">
                <span>Earn</span>
            </div>
            <div class="nav-item" onclick="switchTab('friends', this)">
                <img src="https://alamin12071985-a11y.github.io/cine-link/friends.png" alt="Friends">
                <span>Friends</span>
            </div>
            <div class="nav-item" onclick="switchTab('wallet', this)">
                <img src="https://alamin12071985-a11y.github.io/cine-link/wallet.png" alt="Wallet">
                <span>Wallet</span>
            </div>
        </div>

    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyD1PPDhogcw7fBu27PkO1iuMfGFLUwMN70",
            authDomain: "fir-55206.firebaseapp.com",
            databaseURL: "https://fir-55206-default-rtdb.firebaseio.com",
            projectId: "fir-55206",
            storageBucket: "fir-55206.firebasestorage.app",
            messagingSenderId: "24586463698",
            appId: "1:24586463698:web:8b2f21073295ef4382400b"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- BACKEND & STATE ---
        const backendUrl = "https://snowman-adventure.onrender.com";
        let balance = 0;
        let energy = 500;
        let maxEnergy = 500;
        let level = 1;
        let userId = "test_user_001"; 
        let isBotActive = false;
        let inventory = {};
        let currentOutfit = "https://alamin12071985-a11y.github.io/cine-link/snowman.png"; // Default Image

        // --- OUTFIT DATA LIST ---
        const outfits = [
            // FREE (Level based)
            { id: 'outfit_1', name: 'Starter Winter Pack', price: 0, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Starter Winter Pack.png', desc: 'Royal Blue Jacket' },
            { id: 'outfit_2', name: 'Aurora Gift Pack', price: 0, levelReq: 2, img: 'https://alamin12071985-a11y.github.io/cine-link/Aurora Gift Pack.png', desc: 'Violet Aurora Cape' },
            { id: 'outfit_4', name: 'Arctic Tech Trial', price: 0, levelReq: 3, img: 'https://alamin12071985-a11y.github.io/cine-link/Arctic Tech Trial.png', desc: 'Ice-Mint Hoodie' },
            { id: 'outfit_5', name: 'Cozy Winter Bundle', price: 0, levelReq: 4, img: 'https://alamin12071985-a11y.github.io/cine-link/Cozy Winter Bundle.png', desc: 'Red Scarf & Sweater' },
            { id: 'outfit_6', name: 'Purple Style Access', price: 0, levelReq: 5, img: 'https://alamin12071985-a11y.github.io/cine-link/Purple Style Access.png', desc: 'Deep Purple Coat' },
            // PREMIUM (Stars)
            { id: 'outfit_3', name: 'Gold Explorer Pack', price: 59, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Gold Explorer Pack.png', desc: 'Black & Gold Suit' },
            { id: 'outfit_7', name: 'Emerald Adventure', price: 99, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Emerald Adventure Pack.png', desc: 'Green Adventure Outfit' },
            { id: 'outfit_8', name: 'Fantasy Royal Pack', price: 149, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Fantasy Royal Pack.png', desc: 'White & Gold Armor' },
            { id: 'outfit_9', name: 'Arctic Puffer Pack', price: 199, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Arctic Puffer Pack.png', desc: 'Navy Puffer Jacket' },
            { id: 'outfit_10', name: 'Crystal-Tech Master', price: 299, levelReq: 1, img: 'https://alamin12071985-a11y.github.io/cine-link/Crystal-Tech Master Pack.png', desc: 'Electric Ice Suit' }
        ];

        // --- TON CONNECT ---
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://alamin12071985-a11y.github.io/cine-link/tonconnect-manifest.json'
        });

        // --- INIT ---
        window.addEventListener('load', () => {
            // Fake Loader
            let p = 0;
            const bar = document.getElementById('loadingFill');
            const txt = document.getElementById('loadingPercent');
            const screen = document.getElementById('loading-screen');
            const int = setInterval(() => {
                p += Math.floor(Math.random()*5)+1;
                if(p>100) p=100;
                bar.style.width = p+'%'; txt.innerText = p+'%';
                if(p>=100) { clearInterval(int); setTimeout(() => { screen.style.opacity='0'; setTimeout(()=>screen.style.display='none',500); }, 500); }
            }, 50);

            initTelegramUser();
            startSnowfall();
            loadUserData();
            setInterval(() => { if(energy<maxEnergy){ energy++; updateUI(); } }, 1500);
            setInterval(saveUserData, 5000);
        });

        function initTelegramUser() {
            try {
                const tg = window.Telegram.WebApp;
                tg.expand();
                const user = tg.initDataUnsafe.user;
                if (user) {
                    userId = user.id.toString();
                    if(user.username) document.getElementById('headerName').innerText = user.username;
                    if(user.photo_url) document.getElementById('headerAvatar').src = user.photo_url;
                }
            } catch(e) {}
        }

        // --- DATA SYNC ---
        function saveUserData() {
            if(!userId) return;
            db.ref('users/' + userId).update({
                balance, energy, level, inventory, currentOutfit, lastActive: Date.now()
            });
        }

        function loadUserData() {
            if(!userId) return;
            db.ref('users/' + userId).once('value').then((snapshot) => {
                const data = snapshot.val();
                if (data) {
                    balance = data.balance || 0;
                    energy = data.energy || 500;
                    level = data.level || 1;
                    inventory = data.inventory || {};
                    currentOutfit = data.currentOutfit || "https://alamin12071985-a11y.github.io/cine-link/snowman.png";
                }
                updateUI();
                renderStore(); 
                fetchTasksFromFirebase();
            });
        }

        function updateUI() {
            document.getElementById('displayBalance').innerText = Math.floor(balance).toLocaleString();
            document.getElementById('energyDisplay').innerText = Math.floor(energy);
            document.getElementById('clickerBtn').src = currentOutfit;
            
            // Level Logic
            let nextLevelThreshold = 4000 + ((level - 1) * 8000);
            let prevLevelThreshold = level === 1 ? 0 : (4000 + ((level - 2) * 8000));
            let progress = balance - prevLevelThreshold;
            let range = nextLevelThreshold - prevLevelThreshold;
            let percentage = (progress / range) * 100;

            if (percentage >= 100) { level++; percentage = 0; showGlassPopup(`<h2>Level Up!</h2><p>You are now Lvl ${level}</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`); }
            
            document.getElementById('levelNameHeader').innerText = "LVL " + level;
            document.getElementById('currentLevelHeader').innerText = level;
            document.getElementById('headerLevelBar').style.width = Math.min(percentage, 100) + '%';
        }

        // --- GAMEPLAY ---
        document.getElementById('clickerBtn').addEventListener('click', (e) => {
            if (energy > 0) {
                balance++; energy--;
                updateUI();
                const el = document.createElement('div');
                el.className = 'floating-score'; el.innerText = '+1';
                el.style.left = e.clientX + 'px'; el.style.top = e.clientY + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 800);
            }
        });

        // --- STORE LOGIC (DYNAMIC) ---
        function renderStore() {
            const container = document.getElementById('outfitStore');
            container.innerHTML = `
                <div class="boost-section-title">
                    <img src="https://alamin12071985-a11y.github.io/cine-link/star.png" width="20"> Premium Outfits
                </div>
                <p style="font-size:0.7rem; opacity:0.7; margin-bottom:10px;">Buy outfits to change your look!</p>
            `;

            outfits.forEach(item => {
                const isOwned = inventory[item.id];
                const isEquipped = currentOutfit === item.img;
                
                let btnHTML = '';
                if (isEquipped) {
                    btnHTML = `<div class="boost-price-btn btn-activate" style="border-color:#ccc; opacity:0.7;"><span class="boost-price-val" style="color:#fff">EQUIPPED</span></div>`;
                } else if (isOwned) {
                    btnHTML = `<div class="boost-price-btn btn-activate" onclick="equipOutfit('${item.id}')"><span class="boost-price-val">EQUIP</span></div>`;
                } else {
                    if (item.price === 0) {
                        // FREE LOGIC
                        if (level >= item.levelReq) {
                            btnHTML = `<div class="boost-price-btn" onclick="claimFreeItem('${item.id}')"><span class="boost-price-val" style="color:#00E676">FREE</span></div>`;
                        } else {
                            btnHTML = `<div class="boost-price-btn" style="opacity:0.5"><span class="boost-price-val">Lvl ${item.levelReq}</span></div>`;
                        }
                    } else {
                        // PAID LOGIC
                        btnHTML = `<div class="boost-price-btn" onclick="buyItem(this, '${item.id}', ${item.price})"><img src="https://alamin12071985-a11y.github.io/cine-link/star.png" width="14"><span class="boost-price-val">${item.price}</span></div>`;
                    }
                }

                const div = document.createElement('div');
                div.className = 'boost-item';
                div.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <img src="${item.img}" class="outfit-thumb">
                        <div class="boost-info">
                            <span class="boost-name">${item.name}</span>
                            <div class="boost-desc-small">${item.desc}</div>
                        </div>
                    </div>
                    ${btnHTML}
                `;
                container.appendChild(div);
            });
        }

        function claimFreeItem(id) {
            inventory[id] = true; saveUserData(); renderStore();
            showGlassPopup(`<h2>Claimed!</h2><p>You got a new outfit.</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
        }

        function equipOutfit(id) {
            const item = outfits.find(o => o.id === id);
            if(item) {
                currentOutfit = item.img; saveUserData(); updateUI(); renderStore();
                showGlassPopup(`<h2>Equipped</h2><p>You look great!</p><button class="popup-btn" onclick="closeGlassPopup()">Nice</button>`);
            }
        }

        async function buyItem(btn, itemId, price) {
            if (!window.Telegram.WebApp.initData) return;
            const original = btn.innerHTML;
            btn.innerHTML = "...";
            
            let itemName = "Boost";
            let itemDesc = "Purchase";
            const outfit = outfits.find(o => o.id === itemId);
            if(outfit) { itemName = outfit.name; itemDesc = outfit.desc; }

            try {
                const res = await fetch(`${backendUrl}/generate-invoice`, {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ user_id: userId, item_id: itemId, amount: price, title: itemName, description: itemDesc })
                });
                const data = await res.json();
                
                Telegram.WebApp.openInvoice(data.invoice_link, (status) => {
                    if(status === 'paid') {
                        inventory[itemId] = true; saveUserData(); renderStore();
                        showGlassPopup(`<h2>Success!</h2><p>You bought ${itemName}</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
                    }
                    btn.innerHTML = original;
                });
            } catch(e) {
                btn.innerHTML = original;
                console.error(e);
            }
        }

        function handleStoreClick(btn, itemId, price) {
            // Handler for boosts (not outfits)
            if(inventory[itemId]) {
                // Activate
                if(itemId.includes('energy')) energy = maxEnergy;
                delete inventory[itemId];
                saveUserData(); updateUI();
                showGlassPopup(`<h2>Activated</h2><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
            } else {
                buyItem(btn, itemId, price);
            }
        }

        // --- LOTTERY ---
        function openLottery() { document.getElementById('lotteryModal').classList.add('active'); }
        function closeLottery() { document.getElementById('lotteryModal').classList.remove('active'); }

        async function playLottery() {
            const btn = document.getElementById('lotterySpinBtn');
            btn.innerHTML = "Processing...";
            try {
                const res = await fetch(`${backendUrl}/generate-invoice`, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ user_id: userId, item_id: "lottery_spin", amount: 15, title: "Lottery Spin", description: "Chance to win Jackpot" })
                });
                const data = await res.json();
                Telegram.WebApp.openInvoice(data.invoice_link, (status) => {
                    if(status === 'paid') {
                        btn.style.display = 'none';
                        startLotteryAnimation();
                    } else {
                        btn.innerHTML = 'Spin (15 Stars)';
                    }
                });
            } catch(e) { btn.innerHTML = 'Spin (15 Stars)'; }
        }

        function startLotteryAnimation() {
            const items = document.querySelectorAll('.grid-item');
            const path = [0, 1, 2, 5, 8, 7, 6, 3]; // Outer circle
            let currentStep = 0; let speed = 50; 
            const winJackpot = Math.random() < 0.05; // 5% Chance
            
            function step() {
                items.forEach(i => i.classList.remove('active'));
                let visualIndex = path[currentStep % path.length];
                items[visualIndex].classList.add('active');
                currentStep++;
                
                if(currentStep > 30) speed += 10;
                
                if(currentStep > 50) {
                    items.forEach(i => i.classList.remove('active'));
                    if(winJackpot) {
                        document.getElementById('cCenter').classList.add('active');
                        inventory['outfit_10'] = true;
                        showGlassPopup(`<h2>JACKPOT!</h2><p>You won the Crystal-Tech Master Pack!</p><button class="popup-btn" onclick="closeGlassPopup()">WOW</button>`);
                    } else {
                        let finalIdx = path[Math.floor(Math.random() * path.length)];
                        items[finalIdx].classList.add('active');
                        let txt = items[finalIdx].querySelector('span').innerText;
                        let amt = parseInt(txt);
                        balance += amt;
                        showGlassPopup(`<h2>Won!</h2><p>+${amt} Coins</p><button class="popup-btn" onclick="closeGlassPopup()">Collect</button>`);
                    }
                    saveUserData(); updateUI();
                    document.getElementById('lotterySpinBtn').style.display = 'block';
                    document.getElementById('lotterySpinBtn').innerHTML = 'Spin Again (15 Stars)';
                    return;
                }
                setTimeout(step, speed);
            }
            step();
        }

        // --- UTILS ---
        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
            if(id === 'home') {
                document.body.classList.add('home-active');
                document.getElementById('mainHeader').style.display='flex';
            } else {
                document.body.classList.remove('home-active');
                document.getElementById('mainHeader').style.display='none';
            }
        }

        function showGlassPopup(html) {
            const p = document.getElementById('glassPopup');
            document.getElementById('popupContent').innerHTML = html;
            p.style.display = 'flex';
        }
        function closeGlassPopup() {
            document.getElementById('glassPopup').style.display = 'none';
        }

        function startSnowfall() {
            const c = document.getElementById('snowContainer');
            setInterval(() => {
                const f = document.createElement('div');
                f.style.cssText = `position:absolute; background:white; border-radius:50%; width:3px; height:3px; top:-5px; opacity:0.8; pointer-events:none; left:${Math.random()*100}%; transition: top 3s linear;`;
                c.appendChild(f);
                setTimeout(() => { f.style.top = '100%'; }, 50);
                setTimeout(() => f.remove(), 3000);
            }, 800);
        }

        function fetchTasksFromFirebase() {
            const list = document.getElementById('taskList');
            db.ref('tasks').on('value', (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                list.innerHTML = '';
                Object.keys(data).forEach(key => {
                    const t = data[key];
                    list.innerHTML += `<div class="task-card" onclick="balance+=${t.reward};saveUserData();updateUI();showGlassPopup('<h2>Done</h2><p>+${t.reward}</p><button class=popup-btn onclick=closeGlassPopup()>OK</button>')">
                        <div style="display:flex;align-items:center;gap:15px;"><i class="${t.icon||'fas fa-star'}" style="color:#00E5FF"></i><div><h4>${t.title}</h4><span style="color:#00E5FF">+${t.reward}</span></div></div>
                        <i class="fas fa-chevron-right"></i></div>`;
                });
            });
        }

        function inviteFriend() {
            const url = "https://t.me/thesnowmanbot?start=" + userId;
            navigator.clipboard.writeText(url);
            showGlassPopup(`<h2>Link Copied</h2><p>${url}</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
        }

        function connectWallet() { tonConnectUI.openModal(); }
        function openBoostPage() { switchTab('boostPage'); }
        function goToSpinPage() { switchTab('spinPage'); }
        function handleStartMining() { 
            if(isBotActive) showGlassPopup(`<h2>Bot Active</h2><p>Auto bot is mining!</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
            else openBoostPage();
        }
        function openExchangePopup() { showGlassPopup(`<h2>Exchange</h2><p>Coming Soon</p><button class="popup-btn" onclick="closeGlassPopup()">Close</button>`); }
        function claimDailyReward() {
            const last = localStorage.getItem('lastReward');
            const today = new Date().toDateString();
            if(last === today) { showGlassPopup(`<h2>Claimed</h2><p>Come back tomorrow</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`); return; }
            balance += 500; localStorage.setItem('lastReward', today);
            document.getElementById('dailyRewardAmount').innerText = "Claimed";
            saveUserData(); updateUI();
            showGlassPopup(`<h2>Reward</h2><p>+500 Coins</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
        }

        function doSpin() {
            // Basic spin simulation from your old code
            const wheel = document.getElementById('wheel');
            const deg = Math.floor(5000 + Math.random() * 5000);
            wheel.style.transform = `rotate(${deg}deg)`;
            setTimeout(() => {
                const won = 100 + Math.floor(Math.random()*500);
                balance += won; saveUserData(); updateUI();
                showGlassPopup(`<h2>You Won</h2><p>+${won} Coins</p><button class="popup-btn" onclick="closeGlassPopup()">OK</button>`);
            }, 4000);
        }

    </script>
</body>
</html>
